{% import 'helpers/keyvalue.html' as kv %}
{% import 'helpers/deleter.html' as d %}

{% macro render(section) %}

<img class="icon" src="/static/images/instructions.png" /><h3>Instructions</h3>

{% for group in section %}
<div id="instructions.{{ loop.index0 }}" class="instruction-group">
	{% set groupnumber = loop.index0 %}
	<div class="action-header-nav">
		<img class="action-icon" src="/static/images/tool.png" />
		{{ group.tool }}
	</div>

	{% for tip in group.groups %}
	{% set movenumber = loop.index %}

	{#<!-- INSERT INSTRUCTION IN LIST -->#}
	<div class="insert-block">
		<div class="add-instruction">
			<a href="javascript:void(0);" class="add" onclick="showAddInstruction(this.parentNode);">Insert New Instruction Here</a> 
			<div class="hidden">
				<button class="add-instruction" onclick="edit_insert('instructions.{{ groupnumber }}.{{ movenumber - 1 }}', 'transfer')">Transfer</button>
				<button class="add-instruction" onclick="edit_insert('instructions.{{ groupnumber }}.{{ movenumber - 1 }}', 'distribute')">Distribute</button>
				<button class="add-instruction" onclick="edit_insert('instructions.{{ groupnumber }}.{{ movenumber - 1 }}', 'consolidate')">Consolidate</button>
				<button class="add-instruction" onclick="edit_insert('instructions.{{ groupnumber }}.{{ movenumber - 1 }}', 'mix')">Mix</button>
				<button class="add-instruction cancel" onclick="showAddInstruction(this.parentNode.parentNode);">Cancel</button>
			</div>
		</div>
	</div>

	<div id="instructions.{{ groupnumber }}.{{ movenumber - 1 }}" class="action-block {% if movenumber == 1 and groupnumber == 0 %}view{% endif %} modifyBlock">

		{% for movetype in tip %}
		{# <!-- Realistically, there will only ever be one attribute here --> #}
		<div class="action-header" onclick="toggleInstruction(this.parentNode);">
			<span class="action-number">{{ movenumber }}</span>
			<span class="action-tool">{{ group.tool }}</span>
			<img class="action-icon" src="/static/images/{{ movetype }}.png" />
			<span class="action-title">{{ movetype }}</span>
		</div>
		{% endfor %}

		{% if tip.transfer is defined %}

		{% for move in tip.transfer %}
		<div id="instructions.{{ groupnumber }}.{{ movenumber - 1 }}.{{ loop.index0 }}" class="motion">
			<div class="action-attributes from">
				<img src="/static/images/from.png" class="label" />
				{% for key in move.from %}
				{{ kv.pair(key=key, value=move.from[key] )}}
				{% endfor %}
			</div>

			<div class="action-attributes to">
				<img src="/static/images/to.png" class="label" />
				{% for key in move.to %}
				{{ kv.pair(key=key, value=move.to[key] )}}
				{% endfor %}
			</div>

			<div class="action-attributes attr">
				<img src="/static/images/attributes.png" class="label" />
				{% for attribute in move %}
				{% if (attribute != 'from') and (attribute != 'to') %}
				{{ kv.pair(key=attribute, value=move[attribute] )}}
				{% endif %}
				{% endfor %}
			</div>
			{{ d.draw('right') }}
		</div>
		{% endfor %}


		{% elif tip.distribute is defined %}
		<div class="action-attributes from">
			<img src="/static/images/from.png" class="label" />
			{% for key in tip.distribute.from %}
			{{ kv.pair(key=key, value=tip.distribute.from[key] )}}
			{% endfor %}
		</div>

		<div class="action-attributes to">
			<img src="/static/images/to.png" class="label" />
			{% for location in tip.distribute.to %}
			<div id="instructions.{{ groupnumber }}.{{ movenumber - 1 }}.{{ loop.index0 }}" class="action">
				{% for key in location %}
				{{ kv.pair(key=key, value=location[key] )}}
				{% endfor %}

				{{ d.draw('left') }}
			</div>
			{% endfor %}
		</div>

		<div class="action-attributes attr">
			<img src="/static/images/attributes.png" class="label" />
			{% for attribute in tip.distribute %}
			{% if (attribute != 'from') and (attribute != 'to') %}
			{{ kv.pair(key=attribute, value=tip.distribute[attribute] )}}
			{% endif %}
			{% endfor %}
		</div>
		

		{% elif tip.consolidate is defined %}
		<div class="action-attributes from">
			<img src="/static/images/from.png" class="label" />
			{% for location in tip.consolidate.from %}
			<div id="instructions.{{ groupnumber }}.{{ movenumber - 1 }}.{{ loop.index0 }}" class="action">
				{% for key in location %}
				{{ kv.pair(key=key, value=location[key] )}}
				{% endfor %}

				{{ d.draw('left') }}
			</div>
			{% endfor %}
		</div>

		<div class="action-attributes to">
			<img src="/static/images/to.png" class="label" />
			{% for key in tip.consolidate.to %}
			{{ kv.pair(key=key, value=tip.consolidate.to[key] )}}
			{% endfor %}
		</div>

		<div class="action-attributes attr">
			<img src="/static/images/attributes.png" class="label" />
			{% for attribute in tip.consolidate %}
			{% if (attribute != 'from') and (attribute != 'to') %}
			{{ kv.pair(key=attribute, value=tip.consolidate[attribute] )}}
			{% endif %}
			{% endfor %}
		</div>
		

		{% elif tip.mix is defined %}
		{% for mix in tip.mix %}
		<div id="instructions.{{ groupnumber }}.{{ movenumber - 1 }}.{{ loop.index0 }}" class="action-attributes">
			{% for attribute in mix%}
			{{ kv.pair(key=attribute, value=mix[attribute]) }}
			{% endfor %}

			{{ d.draw('left') }}
		</div>
		{% endfor %}

		{% endif %}

		{{ d.del_ingredient() }}

	</div>
	{% endfor %}

	{#<!-- ADD INSTRUCTION TO END OF LIST -->#}
	<div class="insert-block">
		<div class="add-instruction">
			<a href="javascript:void(0);" class="add" onclick="showAddInstruction(this.parentNode);">Add New Instruction to End</a> 
			<div class="hidden">
				<button class="add-instruction" onclick="edit_add_instruction('instructions.{{ groupnumber }}', 'transfer')">Transfer</button>
				<button class="add-instruction" onclick="edit_add_instruction('instructions.{{ groupnumber }}', 'distribute')">Distribute</button>
				<button class="add-instruction" onclick="edit_add_instruction('instructions.{{ groupnumber }}', 'consolidate')">Consolidate</button>
				<button class="add-instruction" onclick="edit_add_instruction('instructions.{{ groupnumber }}', 'mix')">Mix</button>
				<button class="add-instruction cancel" onclick="showAddInstruction(this.parentNode.parentNode);">Cancel</button>
			</div>
		</div>
	</div>

</div>
{% endfor %}

{% endmacro %}