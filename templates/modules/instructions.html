{% import 'helpers/keyvalue.html' as kv %}

{% macro render(section) %}

<section id="InstructionsToggle">
	{% set moves = [] %}

	{% for group in section %}
	<div class="instruction-group-nav">

		{% set outer = loop.index0 %}
		<div class="action-header-nav">
			<img class="action-icon" src="/static/images/tool.png" />&nbsp;
			{{ group.tool }}
		</div>

		{% for tip in group.groups %}

		{% for attr in tip %}
		{% do moves.append(attr) %}
		{% endfor %}

		<div id="instructions.{{ outer }}.{{ loop.index0 }}.nav" class="action-block-nav {% if moves|length == 1 %}view{% endif %}" onclick="view(this)">
			<span class="action-number">{{ loop.index }}</span>
			<span class="action-title">
				{{ moves[(moves|length) - 1] }}
				<img class="action-icon" src="/static/images/{{ moves[(moves|length) - 1] }}.png" />
			</span>
		</div>
		{% endfor %}

	</div>
	{% endfor %}
</section>

<section id="Instructions">
	<img class="icon" src="/static/images/instructions.png" /><h3>Instructions</h3>

	{% for group in section %}
	{% set outer = loop.index0 %}
	<div class="instruction-group">
<!-- 		<div>tool: {{ group.tool }}</div> -->

		{% for tip in group.groups %}
		<div id="instructions.{{ outer }}.{{ loop.index0 }}" class="action-block {% if loop.index == 1 and outer == 0 %}view{% endif %}">

			<div class="action-header" onclick="view(this.parentNode)">
				<span class="action-number">{{ loop.index }}</span>
				<span class="action-tool">{{ group.tool }}</span>
				<span class="action-title">
					<img class="action-icon" src="/static/images/{{ moves[loop.index0] }}.png" />
					{{ moves[loop.index0] }}
				</span>
			</div>

			{% if tip.transfer is defined %}

			{% for move in tip.transfer %}
			<div class="action-attributes">
				<img src="/static/images/from.png" class="label" />
				{% for key in move.from %}
				{{ kv.pair(key=key, value=move.from[key] )}}
				{% endfor %}
			</div>

			<div class="action-attributes">
				<img src="/static/images/to.png" class="label" />
				{% for key in move.to %}
				{{ kv.pair(key=key, value=move.to[key] )}}
				{% endfor %}
			</div>

			<div class="action-attributes">
				<img src="/static/images/attributes.png" class="label" />
				{% for attribute in move %}
				{% if (attribute != 'from') and (attribute != 'to') %}
				{{ kv.pair(key=attribute, value=move[attribute] )}}
				{% endif %}
				{% endfor %}
			</div>
			{% endfor %}


			{% elif tip.distribute is defined %}
			<div class="action-attributes">
				<img src="/static/images/from.png" class="label" />
				{% for key in tip.distribute.from %}
				{{ kv.pair(key=key, value=tip.distribute.from[key] )}}
				{% endfor %}
			</div>

			<div class="action-attributes">
				<img src="/static/images/to.png" class="label" />
				{% for location in tip.distribute.to %}
				<div class="action">
					{% for key in location %}
					{{ kv.pair(key=key, value=location[key] )}}
					{% endfor %}
				</div>
				{% endfor %}
			</div>

			<div class="action-attributes">
				<img src="/static/images/attributes.png" class="label" />
				{% for attribute in tip.distribute %}
				{% if (attribute != 'from') and (attribute != 'to') %}
				{{ kv.pair(key=attribute, value=tip.distribute[attribute] )}}
				{% endif %}
				{% endfor %}
			</div>
			

			{% elif tip.consolidate is defined %}
			<div class="action-attributes">
				<img src="/static/images/from.png" class="label" />
				{% for location in tip.consolidate.from %}
				<div class="action">
					{% for key in location %}
					{{ kv.pair(key=key, value=location[key] )}}
					{% endfor %}
				</div>
				{% endfor %}
			</div>

			<div class="action-attributes">
				<img src="/static/images/to.png" class="label" />
				{% for key in tip.consolidate.to %}
				{{ kv.pair(key=key, value=tip.consolidate.to[key] )}}
				{% endfor %}
			</div>

			<div class="action-attributes">
				<img src="/static/images/attributes.png" class="label" />
				{% for attribute in tip.consolidate %}
				{% if (attribute != 'from') and (attribute != 'to') %}
				{{ kv.pair(key=attribute, value=tip.consolidate[attribute] )}}
				{% endif %}
				{% endfor %}
			</div>
			

			{% elif tip.mix is defined %}
			{% for mix in tip.mix %}
			<div class="content">
				{% for attribute in mix%}
				{{ kv.pair(key=attribute, value=mix[attribute]) }}
				{% endfor %}
			</div>
			{% endfor %}

			{% endif %}

		</div>
		{% endfor %}

	</div>
	{% endfor %}

{#
	{% for move in moves %}

	<div id="instructions.{{ loop.index0 }}" class="action-block {% if loop.index == 1 %}view{% endif %}" onclick="view(this)">
		<span class="action-number">{{ loop.index }}</span>
		<span class="action-title">
			<img class="action-icon" src="/static/images/{{ moves[loop.index0] }}.png" />
			{{ move }}
		</span>
	</div>

	{% endfor %}
#}
</section>

{% endmacro %}